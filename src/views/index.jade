!!!
html
    head
        title Energiatieto
        link(rel="stylesheet",href="styles/main.css")
        link(rel="stylesheet",href="/components/angular-slider/angular-slider.css")
        script(type="text/javascript",src="/vendor/underscore-min.js")
        script(type="text/javascript",src="/components/jquery/jquery.js")
        script(type="text/javascript",src="/components/angular/angular.js")
        script(type="text/javascript",src="/vendor/proj4.js")
        script(type="text/javascript",src="/vendor/OpenLayers.js")
        script(type="text/javascript",src="/components/d3/d3.js")
        script(type="text/javascript",src="/components/energiatieto-calculation/dist/calculations.js")
        script(type="text/javascript",src="/components/angular-slider/angular-slider.js")
        script(type="text/javascript",src="/js/directives.js")
        script(type="text/javascript",src="/js/address-form.js")
        script(type="text/javascript",src="/js/map.js")
        script(type="text/javascript",src="/js/energysystem.js")
        script(type="text/javascript",src="/js/energycalculation.js")
        script(type="text/javascript",src="/js/pubsub.js")
        script(type="text/javascript",src="/js/constants.js")
        script(type="text/javascript",src="/js/application.js")
    body
        .map(ng-controller="mapController",ng-class="{reduced: reduced, small: small}")
            div(openlayers,
                controls="controls",
                popups="popups",
                layers="layers",
                projection="projection",
                zoom="zoom",
                center="center",
                restricted-extent="bounds",
                style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;")
            .solarlegend
                h3 Aurinkoenergian määrä
                .right Paljon
                .left Vähän
                .grading
            .address-form(ng-controller="addressFormController",ng-hide="hidden")
                h1 Tervetuloa Energiatietopalveluun!
                    span BETA
                p Ota selvää, kuinka paljon kotitaloudessasi voisi säästää ottamalla käyttöön aurinkoenergiaa ja maalämpöä.
                label Osoite (Espoon alueella):
                input.addressInput(ng-model="addressInput",ng-keydown="keyDown")
                ul.flyout(ng-show="addressChoices.length > 0")
                    li(ng-repeat="item in addressChoices", ng-click="selectItem(item)",ng-class="{focus: hasFocus(item)}")
                        span(address-match="item",input="{{addressInput}}")
        .calculations(ng-controller="energyCalculationController",ng-class="{open: open, extended: extended}")
            p.header Energialaskelma
            h1 {{building.address}}
                span BETA
            a.back(href="#",ng-click="reset()",ng-show="open") Takaisin hakuun
            .actioncontainer(ng-show="open")
                .actionbutton Lähetä tarjouspyyntö
                .actionbutton Hae toimenpidelupaa
            #savingsSum.col1.boxed 
                .positioncontainer
                    h2 Säästöt keskimäärin 
                p 327 €/kk
            #productionSum.col2.boxed
                .positioncontainer
                    h2 Energiantuotanto keskimäärin
                p {{calculationResult.averageMonthlyProduction | currencyFormat}} kWh/kk
            #priceSum.col3.boxed 
                .positioncontainer
                    h2 Kokonaishinta
                p {{calculationResult.systemCost.initialInvestment | currencyFormat}} €
            #paybackSum.col4.boxed
                .positioncontainer
                    h2 Takaisinmaksuaika
                p {{calculationResult.systemCost.paybackTime}} v
            .col5.graphbox
                .graphgrid
                    .largegraphs
                        .graphs
                            .fader
                            div 
                                h2 Sähkö
                                .top-caption Oma tuotanto
                                .electricity-graph(d3-graph,ng-model="electricitySeries",layer-classes="electricityLayerClasses")
                                    svg(style='height: 120px; width: 290px;')
                                        .months
                                            .month 1
                                            .month 2
                                            .month 3 
                                            .month 4 
                                            .month 5 
                                            .month 6 
                                            .month 7 
                                            .month 8 
                                            .month 9 
                                            .month 10 
                                            .month 11 
                                            .month 12
                                .bottom-caption Ostettava energia
                            div.divider 
                                h2 Lämpöenergia
                                .heating-graph(d3-graph,ng-model="heatingSeries",layer-classes="heatingLayerClasses")
                                    svg(style='height:120px; width: 290px;')
                                        .months
                                            .month 1
                                            .month 2
                                            .month 3 
                                            .month 4 
                                            .month 5 
                                            .month 6 
                                            .month 7 
                                            .month 8 
                                            .month 9 
                                            .month 10 
                                            .month 11 
                                            .month 12
                            .key Ostoenergia
                                .bought
                            .key Aurinkosähkö
                                .solarelectric
                            .key Aurinkolämpö
                                .solarheat
                            .key Maalämpö
                                .geoterm
                            .key Ylijäämä
                                .surplus
                        .disclaimer Tämä laskelma on suuntaa antava. Laskelma perustuu julkisesti saatavilla oleviin tietoihin ja yleisiin keskiarvoihin. Asunnot, perheet ja elintavat poikkeavat toisistaan paljon, joten tarkimman tuloksen saat, kun tarkistat laskelman pohjatiedot ja korjaat ne mahdollisimman oikeiksi. Huomioithan, että oikeilla tiedoillakin tarkennettu laskelma on edelleen likimääräinen.
                    .smallgraphs
                        h3 Kokonaiskustannukset
                        .payback-graph(d3-payback-graph,ng-model="systemCostSeries",layer-classes="systemCostClasses")
                            svg(style='height: 240px; width: 200px;')
                        .key Nykyinen
                            .current
                        .key Tuleva
                            .future
            .col7.boxed
                .headerbar
                    .info
                        .infopopup Tämä laskelma on suuntaa antava. Laskelma perustuu julkisesti saatavilla oleviin tietoihin ja yleisiin keskiarvoihin. Asunnot, perheet ja elintavat poikkeavat toisistaan paljon, joten tarkimman tuloksen saat, kun tarkistat laskelman pohjatiedot ja korjaat ne mahdollisimman oikeiksi. Huomioithan, että oikeilla tiedoillakin tarkennettu laskelma on edelleen likimääräinen.
                            .downarrow
                    h2 Kiinteistön tiedot
                .table
                    .highlight Tarkista asukasmäärä ja muut tiedot!
                    h3 Käyttäjät ja käyttö
                    table
                        tr
                            td Asukasmäärä:
                            td
                                input.shortInput(type="text",ng-model="building.numberOfInhabitants")
                            td hlö
                        tr
                            td Sähkön kulutus:
                            td
                                input.longInput(type="text",ng-model="building.electricityConsumption")
                            td kWh/v
                        tr
                            td Lämmitysenergian kulutus:
                            td
                                input.longInput(type="text")
                            td kWh/v
                    h3 Kiinteistö
                    table
                        tr
                            td Pinta-ala
                            td
                                input.shortInput(type="text",ng-model="building.floorArea") 
                            td m
                                sup 2
                        tr
                            td Kerrosten lukumäärä:
                            td 
                                input.shortInput(type="text",ng-model="building.floorCount")
                            td
                        tr
                            td Rakennusvuosi:
                            td
                                input.shortInput(type="text",ng-model="building.buildingYear")
                            td
                        tr
                            td Lämmitysmuoto:
                            td
                                .dropdown
                                    select(ng-model="building.heatingSystem", ng-options="key as value for (key, value) in heatingOptions")
                            td
                    .effects
                        .positioncontainer
                            .infobutton(ng-click="showConstants()") Laskelman tiedot
            .col6
                .boxed(ng-class="{disabled: !building.photoVoltaic.active}")
                    .headerbar
                        .info
                            .infopopup Aurinkosähkö on auringon energiasta aurinkokennoilla tuotettua sähköä. Aurinkosähköä voidaan käyttää sähköverkosta saatavan sähkön rinnalla tai itsenäisesti sähköverkon ulkopuolella. Useat energiayhtiöt myös ostavat verkkoon kytkettyjen järjestelmien ylijäämäsähköä.
                                .downarrow
                        h2 Aurinkosähkö
                        span.toggle_solarelectricity_on(ng-click="building.photoVoltaic.active = !building.photoVoltaic.active",ng-show="building.photoVoltaic.active")
                            span Mukana laskelmassa
                        span.toggle_off(ng-click="building.photoVoltaic.active = !building.photoVoltaic.active",ng-hide="building.photoVoltaic.active")
                            span Ei laskelmassa
                    .controls Järjestelmän koko
                        span.slideramount {{building.photoVoltaic.size}} m
                            sup 2
                        slider.solarelectricity(floor="0",ceiling="{{freePhotoVoltaicRoofSize}}",step="1",precision="0",ng-model="building.photoVoltaic.size")
                        .suggestiondash(ng-style="{width: (recommendedPhotoVoltaicPanelPercentage * 70) + '%'}")
                            .suggestionpointer 
                                .suggestion Ehdotus
                    .effects
                        .positioncontainer
                            .infobutton(ng-click="showConstants()") Laskelman tiedot
                        .savings Säästöt
                            p 100 €/kk
                        .production Energiantuotanto
                            p 100 kWh/kk
                        .price Hinta
                            p 100 €
                        .payback Takaisinmaksuaika
                            p 7 v
                        
                .boxed(ng-class="{disabled: !building.thermalPanel.active}")
                    .headerbar
                        .info
                            .infopopup Aurinkolämpö on auringon energiasta aurinkokeräimellä talteen kerättyä lämpöä, joka voidaan varastoida ja käyttää esim. käyttöveden tai sisäilman lämmitykseen. Aurinkolämpö käytetään suoraan muuttamatta sitä sähköksi.
                                .downarrow
                        h2 Aurinkolämpö 
                        span.toggle_solarheat_on(ng-click="building.thermalPanel.active = !building.thermalPanel.active", ng-show="building.thermalPanel.active")
                            span Mukana laskelmassa
                        span.toggle_off(ng-click="building.thermalPanel.active = !building.thermalPanel.active", ng-hide="building.thermalPanel.active")
                            span Ei laskelmassa
                    .controls Järjestelmän koko 
                        span.slideramount{{building.thermalPanel.size}} m
                            sup 2
                        slider.solarheat(floor="0",ceiling="{{freeThermalRoofSize}}",step="1",precision="0",ng-model="building.thermalPanel.size")
                        .suggestiondash(ng-style="{width: (recommendedThermalPanelPercentage * 70) + '%'}")
                            .suggestionpointer
                                .suggestion Ehdotus
                    .effects
                        .positioncontainer
                            .infobutton(ng-click="showConstants()") Laskelman tiedot
                        .savings Säästöt
                            p 100 €/kk
                        .production Energiantuotanto
                            p 100 kWh/kk
                        .price Hinta
                            p 100 €
                        .payback Takaisinmaksuaika
                            p 7 v
                        
                .boxed(ng-class="{disabled: !building.borehole.active}")
                    .headerbar
                        .info
                            .infopopup Maalämpö on auringon säteilystä maaperään varastoitunutta lämpöenergiaa. Maalämpöjärjestelmällä kerättynä sitä voidaan käyttää rakennusten ja käyttöveden lämmittämiseen. 
                                .downarrow
                        h2(ng-click="building.borehole.active = !building.borehole.active") Maalämpö 
                        span.toggle_geoterm_on(ng-click="building.borehole.active = !building.borehole.active", ng-show="building.borehole.active")
                            span Mukana laskelmassa
                        span.toggle_off(ng-click="building.borehole.active = !building.borehole.active", ng-hide="building.borehole.active")
                            span Ei laskelmassa
                    .controls Käytetystä lämmöstä tuotettava osuus
                        span.slideramount {{building.borehole.depthPercentage}} %
                        slider.geoterm(floor="0",ceiling="100",step="1",precision="0",ng-model="building.borehole.depthPercentage")
                        .suggestiondash
                            .suggestionpointer
                                .suggestion Ehdotus
                    .effects
                        .positioncontainer
                            .infobutton(ng-click="showConstants()") Laskelman tiedot   
                        .savings Säästöt
                            p 100 €/kk
                        .production Energiantuotanto
                            p 100 kWh/kk
                        .price Hinta
                            p 100 €
                        .payback Takaisinmaksuaika
                            p 7 v
            .footer
                p Kaupunkisuunnittelukeskus, Espoon kaupunki
        .constants(ng-controller="constantsController",ng-class="{open: open}",ng-show="open")
            .closebutton(ng-click="close()",ng-show="open") Sulje
            .table
                h3 Rakennuskohtaiset tiedot
                table
                    tr
                        td Keskimääräinen huonekorkeus:
                        td
                            input.shortInput(type="text",value="2,8") 
                        td m
                    tr
                        td Lämpimän veden kulutus henkilöä kohti:

                        td 
                            input.shortInput(type="text",value="60")
                        td l/päivä
                    tr
                        td Käyttöveden lämmitystarve:
                        td
                            input.shortInput(type="text",value="50")
                        td °C
                    tr
                        td Käyttöveden lämmityksen häviöt:
                        td
                            input.shortInput(type="text",value="0,89")
                        td 
                    tr
                        td Öljypolttimen hyötysuhde:
                        td
                            input.shortInput(type="text",value="0,87")
                        td 
                    tr
                        td Kaukolämmityksen hyötysuhde: 
                        td
                            input.shortInput(type="text",value="0,97")
                        td 
                    tr
                        td Kiinteistö- ja käyttösähkön vuosikulutus: 
                        td
                            input.shortInput(type="text",value="58")
                        td kWh/m
                            sup 2
            .table
                h3 Katon tiedot
                table
                    tr
                        td Katon pinta-ala: 

                        td
                            input.shortInput(type="text",value="94,88")
                        td m
                            sup 2
                    tr
                        td Säteilyenergia vuodessa koko katolle:
                        td
                            input.shortInput(type="text",value="615,4")
                        td kWh/m
                            sup 2
                    tr
                        td Osuus jolla säteilyenergia yli 900 kWh/m²:
                        td
                            input.shortInput(type="text",value="24,73")
                        td m
                            sup 2
                    tr
                        td Hyvän osuuden säteilyenergia vuodessa:
                        td
                            input.shortInput(type="text",value="936,4")
                        td kWh/m
                            sup 2
            .table
                h3 Aurinkosähköjärjestelmän tiedot
                table
                    tr
                        td Huipputehokerroin:
                        td
                            input.shortInput(type="text",value="0,15")
                        td kWh/m
                            sup 2
                    tr
                        td Käyttötilanteen toimivuuskerroin: 
                        td
                            input.shortInput(type="text",value="0,75")
                        td 
            .table
                h3 Aurinkolämpöjärjestelmän tiedot
                table
                    tr
                        td Keräintyypin kohtauskulmakerroin: 

                        td
                            input.shortInput(type="text",value="0,94")
                        td 
                    tr
                        td Keräimen lämpöhäviökerroin: 
                        td
                            input.shortInput(type="text",value="2")
                        td W/m²K
                    tr
                        td Keräimen häviökerroin: 
                        td
                            input.shortInput(type="text",value="0")
                        td W/m²K²
                    tr
                        td Keräinpiirin hyötysuhde: 
                        td
                            input.shortInput(type="text",value="0,8")
                        td 
                    tr
                        td Optinen hyötysuhde: 
                        td
                            input.shortInput(type="text",value="0,83")
                        td 
                    tr
                        td Lämpimän käyttöveden minimilämpötila: 
                        td
                            input.shortInput(type="text",value="40")
                        td °C
                    tr
                        td Kylmän veden lämpötila: 
                        td
                            input.shortInput(type="text",value="5")
                        td °C
                    tr
                        td Varaajan lisälämmitysosan tilavuus: 
                        td
                            input.shortInput(type="text",value="0")
                        td litraa
                    tr
                        td Lisälämmityksen käyttötapakerroin: 
                        td
                            input.shortInput(type="text",value="0,7")
                        td 
                    tr
                        td Käyttöveden lämmitystarve:
                        td
                            input.shortInput(type="text",value="50")
                        td °C
                    tr
                        td Käyttöveden lämmityksen häviöt: 
                        td
                            input.shortInput(type="text",value="0,89")
                        td 
                    tr
                        td Lämminvesivaraajan mitoitus: 
                        td
                            input.shortInput(type="text",value="75")
                        td l/keräin m²
                    tr
                        td Lämminvesivaraajan mitoitus: 
                        td
                            input.shortInput(type="text",value="2,5")
                        td vrk kulutus
            .table
                h3 Maalämpöjärjestelmän tiedot
                table
                    tr
                        td Kaivon halkaisija: 
                        td
                            input.shortInput(type="text",value="0,13")
                        td m
                    tr
                        td Alin lämpötila kaivossa:
                        td
                            input.shortInput(type="text",value="0,5")
                        td °C
                    tr
                        td Lämmönkeruupiirin lämpötila: 
                        td
                            input.shortInput(type="text",value="-5")
                        td °C
                    tr
                        td Käyttöveden lämpötila: 
                        td
                            input.shortInput(type="text",value="55")
                        td °C
                    tr
                        td Lämmityksen menoveden ylin lämpötila: 
                        td
                            input.shortInput(type="text",value="45")
                        td °C
                    tr
                        td … ulkolämpötilassa: 
                        td
                            input.shortInput(type="text",value="-30")
                        td °C
                    tr
                        td Lämmityksen menoveden alin lämpötila: 
                        td
                            input.shortInput(type="text",value="20")
                        td °C
                    tr
                        td … ulkolämpötilassa: 
                        td
                            input.shortInput(type="text",value="20")
                        td °C
                    tr
                        td Lauhduttimen lämpötilaero: 
                        td
                            input.shortInput(type="text",value="10")
                        td °C
                    tr
                        td Höyrystimen lämpötilaero: 
                        td
                            input.shortInput(type="text",value="5")
                        td °C
                    tr
                        td Häviökerroin: 
                        td
                            input.shortInput(type="text",value="0,5")
                        td